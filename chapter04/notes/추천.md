## 8. 추천(Recommendation)

<h2 style="color: #82515d">☕️ Recall</h2>
<ol>
    <li>연관성 분석은 무엇인가?</li>
    <li>연관 규칙은 무엇인가?</li>
    <li>연관 규칙을 결정하는 지표 3가지는?</li>
    <li>향상도의 값에 따른 아이템의 상관 관계는 어떠한가?</li>
    <li>연관 규칙 탐색 알고리즘에서 효율성이 중요한 이유?</li>
    <li>연관 규칙 탐색 알고리즘의 종류는?</li>
    <li>빈발패턴성장 알고리즘이 연역적 알고리즘보다 뛰어난 이유는?</li>
    <li>빈발패턴트리를 구축하는 과정은?</li>
    <li>빈발패턴트리에서 빈발 패턴을 찾는 과정은?</li>
    <li>협업 필터링이란 무엇인가?</li>
    <li>협업 필터링을 구분하는 두 개의 기준은 무엇인가?</li>
    <li>메모리 기반의 협업 필터링의 동작 방식은 무엇인가?</li>
    <li>사용자 기반의 협업 필터링과 아이템 기반의 협업 필터링의 동작 방식은 무엇인가?</li>
    <li>사용자 간의 유사도를 산정하는 지표와 각 지표를 사용하는 경우는 무엇인가?</li>
    <li>사용자 기반 협업 필터링과 아이템 기반 협업 필터링의 공식은 무엇인가?</li>
    <li>협업 필터링의 한계는 무엇인가?</li>
    <li>모델 기반의 협업 필터링의 목적은 무엇인가?</li>
    <li>교차제곱법의 동작 방법은 무엇인가?</li>
</ol>

---

### 연관성 분석(Association Analysis)
- 마케팅 전략으로 활용
- 고객의 소비 패턴을 파악하는 분석
- **연관규칙(Association Rule)** 을 파악해서 상품들 간의 관계를 파악

### 연관 규칙(Association Rule)
- 상품 구매와 같은 이벤트가 발생하였을 때 상품들이 얼마나 빈번하게 **함께 구매**되는지에 대한 규칙
- 연관 규칙은 지지도(support), 신뢰도(confidence), 향상도(lift) 지표로 파악한다.

### 연관 규칙의 지표
1. 지지도(support): 전체 거래 중에서 아이템 A와 야이템 B가 함께 구매되는 비율
2. 신뢰도(confidence): 아이템 A 거래 중에서 아이템 A와 아이템 B가 함께 구매되는 비율 
3. 향상도(lift): 아이템 A와 아이템 B를 함께 구매하는 비율에서 아이템 B를 구매하는 비율을 나눈 값

|지지도(Support)|신뢰도(Confidence)|향상도(Lift)|
|--------------|---------------|-----------|
|<img width="200" height="" src="./../images/equation_support.png"/>|<img width="200" height="" src="./../images/equation_confidence.png"/>|<img width="200" height="" src="./../images/equation_lift.png"/>|

**✔︎ 향상도의 의미**  
- 향상도(lift)는 아이템 A와 아이템 B이 연관될 가능성이 독립될 가능성에 비해서 얼마나 큰지 평가한다
  - 향상도(lift) > 1: 아이템 A와 아이템 B는 서로 양의 영향력을 가진다
  - 향상도(lift) < 1: 아이템 A와 아이템 B는 서로 음의 영향력을 가진다
  - 향상도(lift) = 1: 아이템 A와 아이템 B는 서로 상관이 없다

<p align="center">
    <img width="400" height="" src="./../images/equation_lift_calculation.png"/>
</p>

### 연관 규칙 탐색 알고리즘
- 연관 규칙은 아이템의 개수에 따라서 지수적으로 증가한다.
  - 아이템 n개에서 가능한 부분 집합의 개수는 2^n - 1개이다.
- 효율적인 연관 규틱 탐색 알고리즘으로는 연역적(apriori) 알고리즘과 빈발패턴성장(FP-growth) 알고리즘이 있다

### 연관 규칙 탐색 알고리즘: 연역적(apriori) 알고리즘
- 아이템으로 만들 수 있는 모든 부분 집합으로부터 시작한다
- 더 이상 탐색하지 않아도 될(빈발하지 않을) 아이템 부분 집합을 판단하고 탐색을 중단한다
- 더 이상 탐색하지 않아도 되는 기준은 해당 아이템 부분 집합이 최소 지지도(minimum support)를 넘는지에 근거한다
  - 최소 지지도를 넘지 못하는 부분 집합은 더 이상 확장하지 않는다

**✔︎ 연역적 알고리즘의 한계 → 빈발패턴성장 알고리즘의 등장 배경**  
- 최악의 경우 아이템으로 생성할 수 있는 모든 부분 집합에 대해서 탐색이 이루어진다
- 최소 지지도를 만족하는 후보군을 대상으로 반복적인 부분 집합 구축 작업이 필요하다

### 연관 규칙 탐색 알고리즘: 빈발패턴성장(FP-growth) 알고리즘
- 트리 구조를 사용해서 데이터의 사이즈를 연역적 알고리즘보다 더 압축하여 탐색한다.
- 빈발패턴성장 = 빈발패턴트리를 구축하는 과정 + 빈발패턴트리에서 패턴을 찾는 과정

**✔︎ 빈발 패턴 성장 트리 구축하기**  
1. 개별 아이템에 대한 지지도를 기반으로 정렬한다. 
   - 최소 지지도를 만족하는 아이템을 선택해서 트리를 구축하는 노드로 결정한다
2. 개별 구매(장바구니)에서 높은 지지도가 부모 노드가 되도록 트리를 구축한다
   - 트리를 구성하는 각 노드(아이템)은 아이템의 이름과 장바구니에 포함된 횟수를 기록한다
   - 개별 구매(장바구니)로부터 트리를 확장하기 때문에 동일한 이름의 아이템도 다른 노드에 할당될 수 있다.
   - 장바구니 A({mustard: 4, soy milk: 3}) 장바구니 B{{soy milk: 3})에서 A의 soy milk는 mustard의 자식으로 B의 soy milk와 다른 노드이다

**✔︎ 빈발 패턴 성장 트리 탐색하기**  
1. 빈발 패턴 성장 트리에서 지지도가 가장 낮은 패턴을 찾는다
   - 아이템 중에서 장바구니에 포함된 횟수가 가장 낮은 아이템을 선택한다
   - 선택된 아이템을 포함하는 루트-리프 경로의 아이템 조합이 지지도가 가장 낮은 패턴이다
2. 조건부 빈발 패턴 트리를 통해 빈발 패턴을 파악한다
   - 장바구니에 포함된 횟수가 가장 낮은 아이템을 조건부로 하는 지지도를 다시 산출한다
   - 패턴에 포함된 모든 아이템의 지지도가 장바구니에 포함된 횟수가 가장 낮은 아이템를 따른다
   - 장바구니에 포함된 횟수가 가장 낮은 아이템과 가장 많이 같이 등장하며 최소 지지도를 넘는 아이템과의 조합이 빈발 패턴이다
3. 1과 2의 과정을 반복한다

### 협업 필터링(Collaborative Filtering)
- 협업 필터링은 사용자 또는 아이템에 대한 정보 없이 사용자의 아이템 평가 정보만을 바탕으로 추천하는 방법이다
- 협업 필터링의 기본 아이디어는 사용자 A와 사용자 B의 아이템 평가 정보를 통해 두 사용자가 서로 유사하다고 판단하고, 유사한 사용자를 비교하여서 소비하지 않은 아이템을 상대방에서 제공하는 것이다
- 협업 필터링은 메모리 기반의 협업 필터링과 모델 기반의 협업 필터링으로 구분한다

<p align="center">
   <img width="400" height="" src="../images/figure_cf.png"/>
</p>

### 메모리 기반의 협업 필터링
- 메모리 기반의 협업 필터링은 사용자-아이템 선호 행렬(User Item Preference Matrix)를 사용한다
- 사용자 기반 추천 방법과 아이템 기반 추천 방법이 있으며 이는 각각 사용자 간 유사도와 아이템 간 유사도를 계산한다
   1. 사용자 기반 추천: 추천을 받고자 하는 사용자와 유사한 사용자를 찾고, 유사한 사용자의 아이템을 추천한다
   2. 아이템 기반 추천: 추천을 받고자 하는 사용자가 소비한 아이템과 유사한 아이템을 추천한다. 아이템의 유사도를 산정하는 것은 사용자-아이템 소비 패턴이다

**✔︎ 사용자 기반 협업 필터링 방법**  
- 사용자 간의 유사도로부터 사용자 u가 소비하지 않은 아이템 i에 대한 스코어(평점)을 산출한다
- 사용자 간의 유사도는 사용자-아이템 행렬에서 피어슨 상관 계수 또는 코사인 유사도를 활용한다
  - 명시적 선호(explicit rating): 피어슨 상관 계수 사용
  - 암시적 선호(implicit rating): 코사인 유사도 사용

**✔︎ 아이템 기반 협업 필터링 방법**  
- 아이템 간의 유사도로부터 사용자 u가 소비하지 않은 아이템 i에 대한 스코어(평점)을 산출한다
- 아이템 간의 유사도는 사용자-아이템 행렬에서 피어슨 상관 계수 또는 코사인 유사도를 활용한다
  - 명시적 선호(explicit rating): 피어슨 상관 계수 사용
  - 암시적 선호(implicit rating): 코사인 유사도 사용

|USER CF|ITEM CF|
|-------|-------|
|<img width="" height="" src="../images/equation_user-cf.png"/>|<img width="" height="" src="../images/equation_item-cf.png"/>|

### 협업 필터링의 한계점
1. 초기 진입 문제(cold start)
   - 새로운 사용자나 새로운 아이템이 추가 되면 이에 대한 소비 정보가 없기 때문에 추천이 이루어지지 않는다
2. 희박성 문제(sparsity problem)
   - 사용자-아이템 행렬은 회소 행렬이므로 사용자 간 유사도 계산이 정확하지 않을 수 있다
3. 확장성
   - 데이터의 크기가 늘어남에 따라서 유사도 계산에 많은 시간이 소요된다
   - 새로운 데이터가 추가될 때마다 사용자-아이템 행렬을 재구축하기 때문에 확장성이 떨어진다 

### 모델 기반의 협업 필터링
- 추천 시스템에 머신 러닝 모델을 적용한다
- 차원 축소를 통해 추천 결과에 영향을 주는 잠재적인 특징을 찾아낸다
- 추천 시스템 모델로서 베이지안 네트워크, 클러스터링 기반 모델, 행렬 분해 기법이 활용된다

### 행렬 분해와 ALS로 구축한 추천 시스템
- 사용자-아이템 행렬을 사용자-잠재 요인 행렬과 잠재 요인-아이템 행렬로 분해한다
- 행렬 분해는 원래의 행렬과 분해된 행렬을 복원한 행렬의 차이가 작도록 학습한다
- 행렬 분해 학습을 위해서 경사하강법 기반의 교차최소제곱법(Alternating Least Square, ALS)이 활용된다

<p align="center">
   <img width="" height="" src="../images/equation_als.png"/>
</p>

**✔︎ 교차제곱법**  
- 행렬 분해식은 두 개의 변수 p와 q로 구성한 cost function을 최소화한다
- 두 개의 변수를 한 번에 최적화하는 대신에 하나의 변수를 고정하고 나머지 하나를 최적화하는 과정을 반복한다

<p align="center">
   <img width="300" height="" src="../images/equation_als-cost.png"/>
</p>
